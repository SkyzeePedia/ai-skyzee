<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Skyzee AI Chat</title>
<style>
*{margin:0;padding:0;box-sizing:border-box}
body{font-family:'Segoe UI',sans-serif;background:#f7f7f8;height:100vh;overflow:hidden;display:flex}

/* Sidebar */
.sidebar{
  width:260px;background:#fff;border-right:1px solid #eee;
  box-shadow:3px 0 10px rgba(0,0,0,0.05);
  display:flex;flex-direction:column;transition:0.3s;
}
.sidebar-header{padding:16px;font-weight:bold;font-size:18px;border-bottom:1px solid #eee}
.new-chat{margin:12px;background:#10a37f;color:#fff;border:none;padding:8px 12px;border-radius:8px;cursor:pointer;box-shadow:0 2px 5px rgba(0,0,0,0.1)}
.chat-list{flex:1;overflow-y:auto;padding:8px}
.chat-item{background:#f0f0f0;border-radius:8px;padding:10px;margin-bottom:8px;cursor:pointer;transition:0.2s}
.chat-item.active{background:#c9f7d0}
.chat-item:hover{background:#ddd}

/* Chat area */
.chat-container{flex:1;display:flex;flex-direction:column;height:100%}
.header{padding:16px 20px;background:#fff;border-bottom:1px solid #eee;display:flex;align-items:center;gap:10px}
.logo{width:32px;height:32px;border-radius:8px;background:#10a37f;display:flex;justify-content:center;align-items:center;color:white;font-weight:bold}

.chat-messages{flex:1;overflow-y:auto;padding:24px;display:flex;flex-direction:column;gap:20px;background:#f7f7f8}
.message{display:flex;gap:12px;max-width:85%;position:relative}
.message.user{flex-direction:row-reverse;align-self:flex-end}
.message-avatar{width:36px;height:36px;border-radius:8px;flex-shrink:0;display:flex;justify-content:center;align-items:center;font-weight:bold;color:white}
.user-avatar{background:#000}
.ai-avatar{background:#10a37f}
.message-content{padding:14px 18px;border-radius:12px;line-height:1.6;position:relative;box-shadow:0 3px 8px rgba(0,0,0,0.1);word-wrap:break-word}
.message.user .message-content{background:#000;color:#fff}
.message.ai .message-content{background:#c9f7d0;color:#000}
.message.user .message-content::after{content:"";position:absolute;top:-8px;right:16px;border-width:0 8px 8px 8px;border-style:solid;border-color:transparent transparent #000 transparent}
.message.ai .message-content::after{content:"";position:absolute;top:-8px;left:16px;border-width:0 8px 8px 8px;border-style:solid;border-color:transparent transparent #c9f7d0 transparent}

.copy-btn,.download-btn{position:absolute;top:8px;font-size:12px;background:rgba(0,0,0,0.6);color:white;border:none;border-radius:4px;padding:4px 6px;cursor:pointer;display:none}
.copy-btn{right:8px}.download-btn{right:60px}
.message.ai:hover .copy-btn,.message.ai:hover .download-btn{display:block}

/* Input */
.input-container{padding:16px;border-top:1px solid #eee;background:#fff;display:flex;gap:12px}
.message-input{flex:1;padding:12px 14px;border:1px solid #ddd;border-radius:12px;font-size:16px;resize:none;max-height:120px;line-height:1.5;box-shadow:inset 0 2px 4px rgba(0,0,0,0.05)}
.send-button{width:50px;height:50px;background:#10a37f url('https://files.catbox.moe/r1px36.png') center/50% no-repeat;border:none;border-radius:12px;cursor:pointer;transition:0.2s;box-shadow:0 3px 6px rgba(0,0,0,0.2)}
.send-button:hover{background-color:#0d8f6f}

.chat-messages::-webkit-scrollbar{width:6px}
.chat-messages::-webkit-scrollbar-thumb{background:#ccc;border-radius:3px}
</style>
</head>
<body>
  <div class="sidebar">
    <div class="sidebar-header">Chats</div>
    <button class="new-chat" id="newChatBtn">+ New Chat</button>
    <div class="chat-list" id="chatList"></div>
  </div>

  <div class="chat-container">
    <div class="header">
      <div class="logo">AI</div>Skyzee AI Chat
    </div>
    <div class="chat-messages" id="chatMessages"></div>
    <div class="input-container">
      <textarea class="message-input" id="messageInput" placeholder="Type your message..." rows="1"></textarea>
      <button class="send-button" id="sendButton"></button>
    </div>
  </div>

<script>
class ChatApp {
  constructor(){
    this.chatMessages=document.getElementById('chatMessages');
    this.messageInput=document.getElementById('messageInput');
    this.sendButton=document.getElementById('sendButton');
    this.apiEndpoint='https://apikey.skyzee.xyz/ai/gemini';
    this.apiKey='skyzee';
    this.chatList=document.getElementById('chatList');
    this.currentChatId=null;
    this.chats=JSON.parse(localStorage.getItem('skyzeeChats')||'{}');
    this.init();
  }
  init(){
    document.getElementById('newChatBtn').onclick=()=>this.newChat();
    this.sendButton.onclick=()=>this.sendMessage();
    this.messageInput.addEventListener('keydown',e=>{
      if(e.key==='Enter'&&!e.shiftKey){e.preventDefault();this.sendMessage();}
    });
    this.messageInput.addEventListener('input',()=>{this.messageInput.style.height='auto';this.messageInput.style.height=Math.min(this.messageInput.scrollHeight,120)+'px';});
    this.loadChatList();
    if(!Object.keys(this.chats).length) this.newChat();
  }
  newChat(){
    const id='chat_'+Date.now();
    this.chats[id]=[];
    this.currentChatId=id;
    this.saveChats();
    this.renderChatList();
    this.loadChat(id);
  }
  renderChatList(){
    this.chatList.innerHTML='';
    Object.keys(this.chats).forEach(id=>{
      const firstMsg=this.chats[id][0]?.content?.slice(0,20)||'New Chat';
      const div=document.createElement('div');
      div.className='chat-item'+(id===this.currentChatId?' active':'');
      div.textContent=firstMsg;
      div.onclick=()=>{this.currentChatId=id;this.loadChat(id);}
      this.chatList.appendChild(div);
    });
  }
  loadChat(id){
    this.chatMessages.innerHTML='';
    this.chats[id].forEach(m=>this.addMessage(m.content,m.sender,false));
    this.renderChatList();
  }
  saveChats(){localStorage.setItem('skyzeeChats',JSON.stringify(this.chats));}
  async sendMessage(){
    const msg=this.messageInput.value.trim();if(!msg||!this.currentChatId)return;
    this.addMessage(msg,'user');this.chats[this.currentChatId].push({sender:'user',content:msg});this.messageInput.value='';this.messageInput.style.height='auto';this.saveChats();
    try{
      const res=await fetch(`${this.apiEndpoint}?apikey=${this.apiKey}&text=${encodeURIComponent(msg)}`);
      const data=await res.json();
      const reply=data.result||data.error||"Error: No response";
      this.addMessage(reply,'ai');this.chats[this.currentChatId].push({sender:'ai',content:reply});this.saveChats();this.renderChatList();
    }catch(err){this.addMessage('❌ '+err.message,'ai');}
  }
  addMessage(content,sender,scroll=true){
    const msgDiv=document.createElement('div');msgDiv.className=`message ${sender}`;
    const avatar=document.createElement('div');avatar.className=`message-avatar ${sender}-avatar`;avatar.textContent=sender==='user'?'You':'AI';
    const contentDiv=document.createElement('div');contentDiv.className='message-content';contentDiv.innerHTML=content.replace(/\n/g,'<br>');
    msgDiv.appendChild(avatar);msgDiv.appendChild(contentDiv);
    if(sender==='ai'){
      const copyBtn=document.createElement('button');copyBtn.className='copy-btn';copyBtn.textContent='Copy';copyBtn.onclick=()=>navigator.clipboard.writeText(content);
      const dlBtn=document.createElement('button');dlBtn.className='download-btn';dlBtn.textContent='↓';dlBtn.onclick=()=>this.downloadMessage(content);
      msgDiv.appendChild(copyBtn);msgDiv.appendChild(dlBtn);
    }
    this.chatMessages.appendChild(msgDiv);
    if(scroll)this.chatMessages.scrollTop=this.chatMessages.scrollHeight;
  }
  downloadMessage(content){
    const blob=new Blob([content],{type:"text/plain"});
    const url=URL.createObjectURL(blob);
    const a=document.createElement('a');a.href=url;a.download='ai_message.txt';a.click();
    URL.revokeObjectURL(url);
  }
}
document.addEventListener('DOMContentLoaded',()=>new ChatApp());
</script>
</body>
</html>
