<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Skyzee AI Chat</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/atom-one-dark.min.css">
<style>
    *{margin:0;padding:0;box-sizing:border-box;}
    body,html{height:100%;width:100%;background:#0a0a0f;display:flex;font-family:'Segoe UI',sans-serif;overflow:hidden;}
    #main{flex:1;display:flex;flex-direction:column;width:100%;}
    header{height:60px;background:#111;color:#fff;display:flex;align-items:center;justify-content:center;padding:0 20px;}
    .chat-container{flex:1;overflow-y:auto;padding:20px;display:flex;flex-direction:column;gap:15px;background:linear-gradient(135deg,#0a0a0f,#1a1a2e);}
    .message{max-width:75%;padding:15px;border-radius:20px;white-space:pre-wrap;line-height:1.5;animation:fadeIn .3s;}
    .user{background:#0ff;color:#000;margin-left:auto;box-shadow:0 0 15px rgba(0,255,255,.5);}
    .ai{background:#222;color:#fff;margin-right:auto;box-shadow:0 0 15px rgba(0,255,255,.2);}
    .code-block{background:#1e1e1e;border-radius:12px;overflow:hidden;position:relative;margin-top:10px;}
    .code-header{background:#333;color:#fff;font-size:12px;padding:6px 10px;display:flex;justify-content:space-between;align-items:center;}
    .copy-btn{cursor:pointer;background:#0ff;color:#000;border:none;border-radius:4px;padding:2px 6px;font-size:12px;}
    pre{margin:0;padding:12px;overflow-x:auto;font-size:13px;}
    .preview-frame{width:100%;height:200px;border:none;border-top:1px solid #444;}
    .chat-input{display:flex;padding:15px;background:#111;border-top:1px solid rgba(255,255,255,0.1);}
    .chat-input input{flex:1;padding:15px 20px;border-radius:25px;border:none;outline:none;background:#000;color:#0ff;}
    #send-btn{width:50px;height:50px;margin-left:10px;border:none;border-radius:50%;background:#0ff;color:#000;font-size:18px;cursor:pointer;}
    @keyframes fadeIn{from{opacity:0;transform:translateY(10px);}to{opacity:1;transform:translateY(0);}}
</style>
</head>
<body>

<div id="main">
    <header>
        <h1>Skyzee Chat</h1>
    </header>

    <div class="chat-container" id="chat-container">
        <div class="message ai">Hi! âš¡ Welcome to Skyzee AI.</div>
    </div>

    <div class="chat-input">
        <input type="text" id="chat-input" placeholder="Type your message...">
        <button id="send-btn"><i class="fas fa-arrow-up"></i></button>
    </div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
<script>
const chatContainer=document.getElementById('chat-container');
const chatInput=document.getElementById('chat-input');
const sendBtn=document.getElementById('send-btn');

function addMessage(content,type='ai'){
    const div=document.createElement('div');
    div.className='message '+type;
    div.textContent=content;
    chatContainer.appendChild(div);
    chatContainer.scrollTop=chatContainer.scrollHeight;
    return div;
}

function renderCode(text){
    return text.replace(/```(\w+)?\n([\s\S]*?)```/g,(m,lang,code)=>{
        const safeLang=lang||'plaintext';
        let preview='';
        if(safeLang==='html'){
            preview=`<iframe class="preview-frame" srcdoc="${encodeURIComponent(code)}"></iframe>`;
        }
        return `<div class="code-block">
            <div class="code-header">${safeLang.toUpperCase()} <button class="copy-btn" onclick="copyCode(this)">Copy</button></div>
            <pre><code class="${safeLang}">${code.replace(/</g,'&lt;')}</code></pre>${preview}
        </div>`;
    });
}

function copyCode(btn){
    const code=btn.closest('.code-block').querySelector('code').innerText;
    navigator.clipboard.writeText(code);
    btn.textContent='Copied!';
    setTimeout(()=>btn.textContent='Copy',2000);
}

async function sendMessage(){
    const question=chatInput.value.trim();if(!question)return;
    addMessage(question,'user');chatInput.value='';

    // Buat container untuk animasi ketik
    const msg=document.createElement('div');
    msg.className='message ai';
    chatContainer.appendChild(msg);
    chatContainer.scrollTop=chatContainer.scrollHeight;

    try{
        const url=`https://apikey.skyzee.xyz/ai/chat-ai?apikey=skyzee&question=${encodeURIComponent(question)}&model=grok-3-mini`;
        const res=await fetch(url);const data=await res.json();
        let text=(data.response||'No response');
        let idx=0;

        // Ketik huruf per huruf
        function type(){
            msg.textContent+=text[idx++];
            chatContainer.scrollTop=chatContainer.scrollHeight;
            if(idx<text.length){setTimeout(type,20);}
            else{
                // Setelah selesai baru parse code block
                msg.innerHTML=renderCode(msg.innerText);
                hljs.highlightAll();
            }
        } type();

    }catch(e){
        msg.textContent='Error connecting to AI.';
    }
}

sendBtn.onclick=sendMessage;
chatInput.addEventListener('keypress',e=>{if(e.key==='Enter')sendMessage();});
</script>
</body>
</html>
